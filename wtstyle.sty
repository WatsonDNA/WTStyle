%%
%% This is file `wtstyle.sty'.
%%
%% Copyright (c) 2016-2017 Takuto ASAKURA (wtsnjp)
%%   GitHub:   https://github.com/wtsnjp
%%   Twitter:  @wtsnjp
%%
%% This package is distributed under the MIT License.
%%

% Package declaration
\NeedsTeXFormat{pLaTeX2e}
\ProvidesPackage{wtstyle}[2017/01/14 dev]
\def\wtst@pkgname{wtstyle}
\RequirePackage{xkeyval}

% Messages
\def\wtst@info{\PackageInfo\wtst@pkgname}
\def\wtst@warn{\PackageWarningNoLine\wtst@pkgname}
\def\wtst@error{\PackageError\wtst@pkgname}

% Utilities
\def\wtst@ifundefined#1{\@ifundefined{wtst@#1}}
\def\wtst@if@option@exists{\@ifnextchar[}
\def\wtst@environment@with@option#1[#2]{\begin{wtst@#1}[#2]}
\def\wtst@environment@without@option#1{\begin{wtst@#1}}

% Trimming spaces
\def\wtst@inner@setkeys#1{\setkeys[wtst]{inner}{key=#1}}
\def\wtst@trimming@spaces#1{%
  \define@key[wtst]{inner}{key}{\def#1{##1}}%
  \expandafter\wtst@inner@setkeys\expandafter{#1}%
  \disable@keys[wtst]{inner}{key}}

% Metadata of document
\define@key[wtst]{docinfo}{title}{\title{#1}}
\define@key[wtst]{docinfo}{author}{\author{#1}}
\define@key[wtst]{docinfo}{date}{\date{#1}}

% Load packages
\define@key[wtst]{docstyle}{packages}{%
  \@for\wtst@current@pkg:=#1\do{%
    \wtst@trimming@spaces\wtst@current@pkg
    \expandafter\wtst@load@pkg\wtst@current@pkg\wtst@nil}}
\def\wtst@load@pkg{%
  \wtst@if@option@exists{\wtst@load@pkg@with@option}{\wtst@load@pkg@without@option}}
\def\wtst@load@pkg@with@option[#1]#2\wtst@nil{\usepackage[#1]{#2}}
\def\wtst@load@pkg@without@option#1\wtst@nil{\usepackage{#1}}

% Counter styles
\define@key[wtst]{docstyle}{footnote mark}{\def\thefootnote{#1}}
\define@key[wtst]{docstyle}{footnote parent}{\@addtoreset{footnote}{#1}}
\define@key[wtst]{docstyle}{parent counter}{\wtst@set@parent@counter{#1}}

\def\wtst@set@parent@counter{%
  \let\wtst@tmp@list\relax
  \wtst@if@option@exists
    {\wtst@set@parent@counter@with@option}
    {\wtst@@set@parent@counter}}
\def\wtst@set@parent@count@with@option[#1]{%
  \edef\wtst@tmp@list{#1}\wtst@@set@parent@counter}
\def\wtst@@set@parent@counter#1{%
  \@ifundefined{wtst@tmp@list}{\def\wtst@tmp@list{equation, figure, table}}{}%
  \@for\wtst@current@cnt:=\wtst@tmp@list\do{%
    \wtst@trimming@spaces\wtst@current@cnt
    \expandafter\wtst@@@set@parent@counter\expandafter{\wtst@current@cnt}{#1}}}
\def\wtst@@@set@parent@counter#1#2{%
  \@namedef{the#1}{\@nameuse{the#2}.\arabic{#1}}%
  \@addtoreset{#1}{#2}}

% Font settings
\define@key[wtst]{docstyle}{emph style}{\DeclareTextFontCommand{\emph}{#1}}
\define@key[wtst]{docstyle}{url style}{\def\UrlFont{#1}}

% Set keys
\newcommand{\setdocinfo}[1]{\setkeys[wtst]{docinfo}{#1}}
\@onlypreamble\setdocinfo

\newcommand{\setdocstyle}[1]{\setkeys[wtst]{docstyle}{#1}}
\@onlypreamble\setdocstyle

% All done
\endinput

%% EOF
