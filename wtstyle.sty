%
% wtstyle.sty
%

%%%% package declaration
\NeedsTeXFormat{pLaTeX2e}
\ProvidesPackage{wtstyle}
\def\wtst@pkgname{wtstyle}

%%%% error messages
\def\wtst@warn{\PackageWarningNoLine\wtst@pkgname}
\def\wtst@error{\PackageError\wtst@pkgname}

%%%% newifs
\newif\if@wtst@chapter@exist@
\newif\if@wtst@first@format@\@wtst@first@format@true
\newif\if@wtst@simple@\@wtst@simple@false

%%%% utilities
\def\wtst@if@option@exist{\@ifnextchar[}
\def\wtst@environment@with@option#1[#2]{\begin{wtst@#1}[#2]}
\def\wtst@environment@without@option#1{\begin{wtst@#1}}

%%%% check chapter
\@ifundefined{thechapter}{\@wtst@chapter@exist@false}{\@wtst@chapter@exist@true}
\if@wtst@chapter@exist@
  \def\wtst@addtoreset#1{\@addtoreset{#1}{chapter}}
  \let\wtst@thepcounter\thechapter
\else
  \def\wtst@addtoreset#1{\@addtoreset{#1}{section}}
  \let\wtst@thepcounter\thesection
\fi

%%%% check option
\def\wtst@check@first@format{%
  \if@wtst@first@format@
    \@wtst@first@format@false
  \else
    \wtst@error{You can not use multiple formats}%
  \fi}

%%%% options
\DeclareOption{simple}{\wtst@check@first@format\@wtst@simple@true}
\ProcessOptions\relax

%%%% styles

%% common

% footnote
\renewcommand\thefootnote{\arabic{footnote})}
\wtst@addtoreset{footnote}

% equation
\renewcommand{\theequation}{\wtst@thepcounter.\arabic{equation}}
\wtst@addtoreset{equation}

% figure
\renewcommand{\thefigure}{\wtst@thepcounter.\arabic{figure}}
\wtst@addtoreset{figure}

% table
\renewcommand{\thetable}{\wtst@thepcounter.\arabic{table}}
\wtst@addtoreset{table}

%% simple
\if@wtst@simple@

% packages and settings
\RequirePackage{tcolorbox}
\tcbuselibrary{breakable}
\newtcolorbox{wtst@mathbox}
  {sharp corners,colback=white,left=2mm,right=2mm,enlarge top initially by=2mm}

% heading
\def\@makeschapterhead#1{%
  \hbox{}\normalsize
  \vskip\baselineskip
  \hrule\@height.6\p@\@depth.6\p@\vskip2\p@\hrule\@height.3\p@\@depth.3\p@
  \vskip.5\baselineskip
  \begingroup\centering
    \reset@font\LARGE\bfseries#1%
  \par\endgroup
  \ifdim\prevdepth>-\@m\p@\vskip-\prevdepth\fi
  \vskip.5\baselineskip
  \hrule\@height.3\p@\@depth.3\p@\vskip2\p@\hrule\@height.6\p@\@depth.6\p@
  \vskip\baselineskip}
\def\@makechapterhead#1{%
  \hbox{}\normalsize
  \vskip\baselineskip
  \hrule\@height.6\p@\@depth.6\p@\vskip2\p@\hrule\@height.3\p@\@depth.3\p@
  \vskip.5\baselineskip
  \begingroup\centering\bfseries
    \@chapapp
    {\mdseries\sffamily\Large\thechapter}%
    \@chappos\\
    \LARGE#1%
  \par\endgroup
  \ifdim\prevdepth>-\@m\p@\vskip-\prevdepth\fi
  \vskip.5\baselineskip
  \hrule\@height.3\p@\@depth.3\p@\vskip2\p@\hrule\@height.6\p@\@depth.6\p@
  \vskip\baselineskip}

% theorem
\if@wtst@chapter@exist@
  \newtheorem{wtst@definition}{定義}[chapter]
  \newtheorem{wtst@theorem}{定理}[chapter]
  \newtheorem{wtst@lemma}[wtst@theorem]{補題}
  % \newcounter{wtst@example}[chapter]
  \newtheorem{wtst@example}{例}[chapter]
\else
  \newtheorem{wtst@definition}{定義}[section]
  \newtheorem{wtst@theorem}{定理}[section]
  \newtheorem{wtst@lemma}[wtst@theorem]{補題}
  % \newcounter{wtst@example}[section]
  \newtheorem{wtst@example}{例}[section]
\fi

\newenvironment{definition}
  {\begin{wtst@mathbox}
    \wtst@if@option@exist
      {\wtst@environment@with@option{definition}}
      {\wtst@environment@without@option{definition}}}
  {\end{wtst@definition}\end{wtst@mathbox}}
\newenvironment{theorem}
  {\begin{wtst@mathbox}
    \wtst@if@option@exist
      {\wtst@environment@with@option{theorem}}
      {\wtst@environment@without@option{theorem}}}
  {\end{wtst@theorem}\end{wtst@mathbox}}
\newenvironment{lemma}
  {\begin{wtst@mathbox}
    \wtst@if@option@exist
      {\wtst@environment@with@option{lemma}}
      {\wtst@environment@without@option{lemma}}}
  {\end{wtst@lemma}\end{wtst@mathbox}}
\newenvironment{example}{\begin{wtst@example}}{\end{wtst@example}}
% \newenvironment{example}
%   {\par\normalfont\topsep\z@\@plus6\p@\labelsep=1zw\refstepcounter{wtst@example}
%     \trivlist\item[\hskip\labelsep{\headfont 例\thechapter.\thewtst@example}]\ignorespaces}
%   {\endtrivlist\addvspace{6pt}}
\newenvironment{proof}
  {\par\normalfont\topsep\z@\@plus6\p@\labelsep=1zw
    \trivlist\item[\hskip\labelsep{\headfont 証明}]\ignorespaces}
  {\endtrivlist}

\fi
%% end simple

%% EOF
